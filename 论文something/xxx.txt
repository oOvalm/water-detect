系统详细设计与实现
3.1 用户模块
用户模块是系统的基础功能模块，主要实现用户注册、登录、个人信息管理等功能。
3.1.1 模块设计
用户模块采用基于JWT(JSON Web Token)的身份认证机制，通过Token的方式维护用户登录状态，确保系统安全性。模块的核心功能包括：
用户注册：支持邮箱注册，密码需符合安全要求
用户登录：支持邮箱登录，采用JWT认证机制
个人信息管理：支持修改用户基本信息
密码找回：通过邮箱验证码方式重置密码
3.1.2 实现流程
注册流程：
前端进行表单验证，确保邮箱格式正确，密码符合6-16位要求
后端接收注册请求，验证邮箱是否已被注册
使用sha256算法对密码进行加密存储
创建用户记录，返回注册成功响应
登录流程：
用户输入邮箱和密码
后端验证用户信息，生成JWT令牌
前端存储令牌，后续请求携带令牌进行身份验证
个人信息管理：
用户可修改头像、昵称、性别等信息
采用表单验证确保数据合法性
支持头像文件上传功能
3.2 文件系统模块
文件系统模块提供文件的组织管理功能，支持多级目录结构。
3.2.1 模块设计
采用树形结构设计文件系统，通过父子关系维护目录层级。核心功能包括：
目录创建与删除
文件移动与重命名
批量操作支持
文件元信息管理
3.2.2 实现流程
目录操作：
使用file_pid字段记录父目录ID，根目录使用-1表示
创建目录时生成唯一的file_uid
删除目录时递归处理子目录及文件
文件管理：
支持文件重命名、移动等操作
维护文件创建时间、修改时间等元信息
实现批量选择和操作功能
3.3 文件上传模块
文件上传模块处理大文件的分片上传，确保传输可靠性。
3.3.1 模块设计
采用分片上传策略，主要功能包括：
文件分片上传
断点续传支持
上传进度显示
文件完整性验证
3.3.2 实现流程
分片上传：
前端将文件分割成固定大小的块
使用异步请求并发上传分片
后端接收分片并临时存储
文件合并：
所有分片上传完成后发起合并请求
后端按序合并分片，生成完整文件
验证文件完整性，更新数据库记录

3.4 在线浏览模块
在线浏览模块为用户提供媒体文件的在线预览功能，支持图片查看和视频播放。
3.4.1 模块设计
基于HLS协议实现视频流式传输，主要功能包括：
图片在线预览
视频在线播放
视频切片管理
播放进度控制
3.4.2 实现流程
视频处理流程：
使用FFmpeg将视频转换为HLS格式
生成m3u8索引文件和ts切片文件
前端通过DPlayer播放器实现视频播放
支持进度跳转和清晰度切换
图片处理流程：
支持主流图片格式在线预览
提供图片缩放和旋转功能
实现图片懒加载优化性能
3.5 目标检测模块
目标检测模块集成YOLO算法，实现水域目标的智能识别。
3.5.1 模块设计
采用微服务架构，将检测服务独立部署，核心功能包括：
图片目标检测
视频流检测
检测结果可视化
检测进度管理
3.5.2 实现流程
检测任务处理：
通过RabbitMQ消息队列分发检测任务
使用Redis记录检测进度
支持批量文件异步检测
实时更新检测状态
结果处理流程：
生成检测结果可视化效果
保存检测后的媒体文件
建立原文件与检测结果文件的关联关系
3.6 流媒体模块
流媒体模块处理实时视频流的接收、转发和检测。
3.6.1 模块设计
基于RTMP和HLS协议实现流媒体传输，主要功能包括：
直播流接收
实时检测处理
直播流转发
直播回放管理
3.6.2 实现流程
直播流处理：
通过Nginx-RTMP模块接收RTMP推流
将RTMP流转换为HLS格式
对视频流进行实时检测
生成检测后的直播流
直播管理：
支持直播流密钥管理
实现直播权限控制
提供直播回放功能
记录直播会话信息
3.7 文件分享模块
文件分享模块实现用户间的文件共享功能。
3.7.1 模块设计
采用链接分享方式，核心功能包括：
分享链接生成
访问权限控制
提取码管理
分享统计分析
3.7.2 实现流程
分享链接生成：
生成唯一的分享码
设置分享有效期
可选配置提取码
记录分享相关信息
分享访问控制：
验证分享链接有效性
校验提取码
控制分享文件访问权限
统计分享文件访问次数